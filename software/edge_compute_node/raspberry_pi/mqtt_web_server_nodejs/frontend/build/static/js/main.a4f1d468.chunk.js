(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{104:function(e,t,a){e.exports=a.p+"static/media/logo.68d2b4f9.png"},109:function(e,t,a){e.exports=a(196)},114:function(e,t,a){},115:function(e,t,a){},189:function(e,t,a){},196:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(102),c=a.n(o),l=(a(114),a(105)),i=a(57),s=a(33),m=a(60),u=(a(115),a(76)),d=a(222),p=function(e){var t=e.lastHeard,a=void 0===t?{}:t;return r.a.createElement("div",{style:{margin:"auto"}},r.a.createElement("h2",null,"Node Health"),Object.keys(a).length?r.a.createElement("table",{align:"center"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Node ID"),r.a.createElement("th",null,"Last Heard"))),r.a.createElement("tbody",null,Object.keys(a).map((function(e,t){var n=(new Date).valueOf()-new Date(a[e]).valueOf()<36e5;return r.a.createElement("tr",{key:t},r.a.createElement("td",{style:{color:d.a[t%10]}},e),r.a.createElement("td",{title:n?"Last message from this node received within the past hour":"Last message > 1 hour ago",style:{color:n?"green":"red"}},u.DateTime.fromISO(a[e]).toLocaleString(u.DateTime.DATETIME_MED_WITH_SECONDS)))})))):r.a.createElement("p",null,"Waiting for data..."))},f=a(103),h=a.n(f),E=a(221),b=a(223),v=(a(189),function(e){var t=e.sapflowData,a=void 0===t?[]:t,n=e.lastHeard,o=void 0===n?{}:n,c={points:a.flatMap((function(e){return[Object(s.a)({},e,{pointId:"".concat(e.id,"-temp1"),temp:e.temp1}),Object(s.a)({},e,{pointId:"".concat(e.id,"-temp2"),temp:e.temp2})]})),responsiveWidth:!0,hoverAnnotation:!0,size:[700,400],margin:{left:60,bottom:90,right:10,top:40},xAccessor:function(e){return new Date(e.rtcUnixTimestamp)},yAccessor:"temp",xScaleType:Object(E.a)(),pointStyle:function(e){return{r:5,fill:d.a[Object.keys(o).indexOf(e.id)%10]}},title:r.a.createElement("text",{textAnchor:"middle"},"Sapflow Raw Datapoints"),axes:[{orient:"left",label:"Temperature (C)"},{orient:"bottom",label:"Time",tickFormat:Object(b.a)("%I:%M:%S %p"),ticks:4}],tooltipContent:function(e){return r.a.createElement("div",{className:"tooltip-content"},r.a.createElement("p",null,"Time: ",Object(b.a)("%I:%M:%S %p")(new Date(e.rtcUnixTimestamp))),r.a.createElement("p",null,"Temperature (C): ",e.temp),r.a.createElement("p",null,"Node: ",e.pointId))}};return r.a.createElement("div",{style:{maxWidth:"1000px",margin:"auto"}},r.a.createElement("h2",null,"Dashboard"),a.length?r.a.createElement(h.a,c):r.a.createElement("p",{style:{height:"400px"}},"Waiting for data..."))}),g=function(e){var t=e.sapflowData;return r.a.createElement("div",null,r.a.createElement("h2",null,"Raw Data"),t.length?r.a.createElement("div",{style:{overflow:"scroll"}},r.a.createElement("table",{align:"center"},r.a.createElement("thead",null,r.a.createElement("tr",null,Object.keys(t[0]).map((function(e,t){return r.a.createElement("th",{key:"header-".concat(t)},e)})))),r.a.createElement("tbody",null,t.map((function(e,t){return r.a.createElement("tr",{key:"row-".concat(t)},Object.keys(e).map((function(a,n){return r.a.createElement("td",{key:"cell-".concat(t,"-").concat(n)},e[a])})))}))))):r.a.createElement("p",null,"Waiting for data..."))},w=a(104),O=a.n(w);var y=function(){var e=Object(n.useState)({}),t=Object(m.a)(e,2),a=t[0],o=t[1],c=Object(n.useState)([]),u=Object(m.a)(c,2),d=u[0],f=u[1],h=Object(n.useState)(!1),E=Object(m.a)(h,2),b=E[0],w=E[1];return Object(n.useEffect)((function(){fetch("/lastHeard").then((function(e){return e.json()})).then((function(e){o(e.lastHeard)})).catch((function(e){console.error("Could not fetch lastHeard route from server due to error: ",e)}))}),[]),Object(n.useEffect)((function(){fetch("/serverIp").then((function(e){return e.json()})).then((function(e){var t=new WebSocket("ws://".concat(e.serverIp||"localhost",":8080"));t.onopen=function(){console.log("Websocket connection opened"),w(!0)},t.onclose=function(){console.log("Websocket connection closed")},t.onmessage=function(e){var t=JSON.parse(e.data);switch(t.type){case"mqtt":if("sapflow"===t.topic){var a=t.message,n=JSON.parse(a),r=n.id,c=(new Date).toISOString();o((function(e){return Object(s.a)({},e,Object(i.a)({},r,c))})),f((function(e){return[].concat(Object(l.a)(e),[Object(s.a)({},n,{timeReceived:c})])}))}break;case"wsHeartbeat":break;default:console.error("Unhandled data type received from websocket: ".concat(t.type))}},t.onerror=function(e){console.error("WebSocket error observed:",e)}})).catch((function(e){console.error("Could not fetch lastHeard route from server due to error: ",e)}))}),[]),r.a.createElement("div",{className:"App"},r.a.createElement("header",{className:"App-header"},r.a.createElement("h1",null,"Sapflow Status")),r.a.createElement("div",{className:"dashboard-container"},b?r.a.createElement("p",{style:{color:"green"}},"Websocket connection opened."):r.a.createElement("p",{style:{color:"red"}},"Websocket failed to connect. Refresh to try again."),r.a.createElement(v,{lastHeard:a,sapflowData:d}),r.a.createElement(p,{lastHeard:a}),r.a.createElement(g,{sapflowData:d}),r.a.createElement("img",{style:{maxWidth:"100px"},alt:"Dotmote Labs logo",src:O.a})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(y,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[109,1,2]]]);
//# sourceMappingURL=main.a4f1d468.chunk.js.map